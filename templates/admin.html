{% extends "base.html" %}
{% block content %}

<h1>All Feedback</h1>

<!-- Top action row (CSV export, seed users, view logs) -->
<div class="row" style="margin-bottom:12px; gap:8px; align-items:center;">
  <div>
    <a href="{{ url_for('main.export_feedback') }}"><button>Download CSV</button></a>
  </div>

  <!-- New: create demo users (admin only) -->
  <div>
    <form method="post" action="{{ url_for('main.admin_seed_users') }}">
      <button type="submit" class="secondary">Generate Test Users</button>
    </form>
  </div>

  <div>
    <a href="{{ url_for('main.admin_logs') }}"><button class="secondary">View Logs</button></a>
  </div>
</div>

<table>
  <tr>
    <th>ID</th>
    <th>Timestamp</th>
    <th>User</th>
    <th>Emotion</th>
    <th>Prompt</th>
    <th>Advice</th>
    <th>Matched?</th>
    <th>Advice OK?</th>
    <th>Comments</th>
  </tr>

  {% for r in rows %}
  <tr>
    <td>{{ r["id"] }}</td>
    <td>{{ r["created_at"] }}</td>
    <td>{{ r["username"] }}</td>
    <td>{{ r["emotion"] }}</td>
    <td><pre style="white-space:pre-wrap;margin:0">{{ r["prompt"] }}</pre></td>
    <td><pre style="white-space:pre-wrap;margin:0">{{ r["advice"] }}</pre></td>
    <td>{{ 'Yes' if r["predicted_correct"] else 'No' }}</td>
    <td>{{ 'Yes' if r["advice_ok"] else 'No' }}</td>
    <td><pre style="white-space:pre-wrap;margin:0">{{ r["comments"] }}</pre></td>
  </tr>
  {% endfor %}
</table>

{% endblock %}

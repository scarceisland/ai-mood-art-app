<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - AI Art Mood App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #1a1a1a;
            color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            background: #2d2d2d;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 400px;
            padding: 30px;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #ffffff;
        }

        .subtitle {
            text-align: center;
            margin-bottom: 25px;
            color: #a0a0a0;
            font-size: 14px;
        }

        .error {
            background: #5e2a2a;
            color: #ff8f8f;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #ff5252;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            background: #3d3d3d;
            border: 1px solid #4d4d4d;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 16px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #6b8cff;
        }

        .spacer {
            height: 20px;
        }

        button {
            width: 100%;
            padding: 14px;
            background: #6b8cff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #5a7ae0;
        }

        .admin-link {
            text-align: center;
            margin-top: 20px;
        }

        .admin-link a {
            color: #6b8cff;
            text-decoration: none;
        }

        .admin-link a:hover {
            text-decoration: underline;
        }

        .info {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #3d3d3d;
            font-size: 13px;
            color: #888;
        }

        .info p {
            margin-bottom: 8px;
        }

        .username-dropdown {
            position: absolute;
            background: #3d3d3d;
            border: 1px solid #4d4d4d;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .username-option {
            padding: 10px;
            cursor: pointer;
        }

        .username-option:hover {
            background: #4d4d4d;
        }

        .input-container {
            position: relative;
        }

        .password-display {
            background: #3d3d3d;
            border: 1px solid #4d4d4d;
            border-radius: 4px;
            padding: 12px;
            min-height: 44px;
            font-size: 16px;
            color: #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <h1>Welcome</h1>
        <p class="subtitle">Select your username to login</p>

        {% if error %}
        <div class="error">{{ error }}</div>
        {% endif %}

        <form method="post" action="{{ url_for('main.login') }}">
            <input type="hidden" name="password" id="password_select" value="">

            <div class="form-group">
                <label for="username">Username</label>
                <div class="input-container">
                    <input
                        type="text"
                        id="username"
                        name="username"
                        placeholder="Type or select your username"
                        autocomplete="username"
                        required
                        value="{{ request.form.username if request.form else '' }}"
                    >
                    <div class="username-dropdown" id="usernameDropdown">
                        <div class="username-option" data-username="paul">paul</div>
                        <div class="username-option" data-username="sarah">sarah</div>
                        <div class="username-option" data-username="john">john</div>
                        <div class="username-option" data-username="dana">dana</div>
                        <div class="username-option" data-username="eric">eric</div>
                        <div class="username-option" data-username="fran">fran</div>
                        <div class="username-option" data-username="guest">guest</div>
                        <div class="username-option" data-username="mike">mike</div>
                        <div class="username-option" data-username="lisa">lisa</div>
                        <div class="username-option" data-username="tom">tom</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
    <label for="password_display">Password</label>
    <div class="password-display" id="password_display">
        {% if request.form and request.form.password_select %}
            ••••••••
        {% else %}
            Select a username first
        {% endif %}
    </div>
</div>
            <div class="spacer"></div>

            <button type="submit">Login</button>
        </form>

        <div class="admin-link">
            <a href="{{ url_for('main.admin_login_page') }}">Admin Login</a>
        </div>

        <div class="info">
            <p>Images: Pollinations (no key) • Data: SQLite in /data • HTMX for no-reload actions</p>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const usernameInput = document.getElementById('username');
        const passwordSelect = document.getElementById('password_select');
        const passwordDisplay = document.getElementById('password_display');
        const usernameDropdown = document.getElementById('usernameDropdown');
        const usernameOptions = document.querySelectorAll('.username-option');

        // Username to password mapping
        const userPasswords = {
            'paul': 'paul123',
            'sarah': 'sarah123',
            'john': 'john123',
            'dana': 'dana123',
            'eric': 'eric123',
            'fran': 'fran123',
            'guest': 'guest123',
            'mike': 'mike123',
            'lisa': 'lisa123',
            'tom': 'tom123'
        };

        // Show dropdown when username input is focused
        usernameInput.addEventListener('focus', function() {
            usernameDropdown.style.display = 'block';
            filterDropdown('');
        });

        // Hide dropdown when clicking outside - FIXED
        document.addEventListener('click', function(e) {
            const usernameInput = document.getElementById('username');
            const usernameDropdown = document.getElementById('usernameDropdown');

            if (usernameInput && usernameDropdown) {
                if (!usernameInput.contains(e.target) && !usernameDropdown.contains(e.target)) {
                    usernameDropdown.style.display = 'none';
                }
            }
        });

        // Filter dropdown options based on input
        usernameInput.addEventListener('input', function() {
            filterDropdown(this.value);
            updatePasswordForUsername(this.value);
        });

        // Handle selection from dropdown
        usernameOptions.forEach(option => {
            option.addEventListener('click', function() {
                const username = this.getAttribute('data-username');
                usernameInput.value = username;
                updatePasswordForUsername(username);
                usernameDropdown.style.display = 'none';
            });
        });

        // Update password when username changes
        usernameInput.addEventListener('change', function() {
            updatePasswordForUsername(this.value);
        });

        // Update password for the given username - FIXED
        function updatePasswordForUsername(username) {
            const normalizedUsername = username.toLowerCase();
            if (userPasswords[normalizedUsername]) {
                // Set the hidden field (for form submission) - CORRECT ID
                document.getElementById('password_select').value = userPasswords[normalizedUsername];
                // Set the visible field (for user feedback) - CORRECT ID
                document.getElementById('password_display').textContent = '••••••••';
                console.log("DEBUG: Set password for", username, "to", userPasswords[normalizedUsername]);
            } else {
                document.getElementById('password_select').value = '';
                document.getElementById('password_display').textContent = 'Select a username first';
                console.log("DEBUG: No password found for", username);
            }
        }

        // Filter function for dropdown
        function filterDropdown(value) {
            const searchTerm = value.toLowerCase();

            usernameOptions.forEach(option => {
                const username = option.getAttribute('data-username').toLowerCase();
                if (username.includes(searchTerm)) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });
        }

        // Debug: Log that userPasswords is loaded
        console.log("userPasswords loaded with", Object.keys(userPasswords).length, "users");

        // Preserve form values if there was an error
        {% if error and request.form %}
            updatePasswordForUsername('{{ request.form.username }}');
            filterDropdown('{{ request.form.username }}');
        {% endif %}
    });
</script>

                // ===== DEBUG SCRIPT - FIXED VERSION =====
        console.log("Login page loaded");

        // Check if JavaScript is working - moved to global scope
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM fully loaded");
        });

        // Monitor form submission - simplified
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    console.log("=== FORM SUBMISSION DEBUG ===");
                    console.log("Form submitted!");

                    const username = document.getElementById('username')?.value;
                    const passwordSelect = document.getElementById('password_select')?.value;

                    console.log("Username field value:", username);
                    console.log("Hidden password field value:", passwordSelect);
                    console.log("Form action:", this.action);
                    console.log("Form method:", this.method);

                    // Check if password is actually set
                    if (!passwordSelect) {
                        console.error("❌ ERROR: Hidden password field is empty!");
                        console.error("This means the JavaScript didn't set the password properly");
                    } else {
                        console.log("✅ Password field is populated");
                    }

                    // Let the form submit normally so we can see what happens
                });
            }
        });
        // ===== END DEBUG SCRIPT =====

                // Quick test: Check if form exists and can be submitted
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                const form = document.querySelector('form');
                const submitButton = form.querySelector('button[type="submit"]');

                console.log("Form element:", form ? "✅ Found" : "❌ Missing");
                console.log("Submit button:", submitButton ? "✅ Found" : "❌ Missing");

                // Test form submission programmatically
                if (form && submitButton) {
                    console.log("Form action:", form.action);
                    console.log("Form method:", form.method);

                    // Test if we can trigger submission
                    submitButton.addEventListener('click', function() {
                        console.log("Submit button clicked!");
                    });
                }
            }, 1000);
        });

    </script>
</body>
</html>